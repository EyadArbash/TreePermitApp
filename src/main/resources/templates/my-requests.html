<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Mein Antrag</title>
    <link rel="stylesheet" th:href="@{/resources/css/my_requests.css}">
    <link rel="stylesheet" th:href="@{/resources/css/communication_interface.css}">
    <script th:src="@{/resources/js/my_requests.js}" defer></script>
</head>
<body>
    <div class="header-bar">
        <form action="/logout" method="post">
            <button type="submit" class="logout-button">Logout</button>
        </form>
    </div>
    
    <div class="container">
        <h1>Antragsdetails</h1>
        <div th:each="req, iterStat : ${requests}" class="card">
            <button class="collapsible">Antrag #<span th:text="${iterStat.count}">1</span>: <span th:class="${req.status != null ? 'status-' + req.status.toString().toLowerCase() : 'status-unbekannt'}" th:text="' - ' + (${req.status != null} ? ${req.status} : 'UNBEKANNT')"></span></button>
            <div class="content">
                <!-- Antrag Details -->
            </div>
        </div>
        <div class="button-container">
            <button class="buttonAb" onclick="window.location.href='/dashboard_user';">Zur√ºck</button>
            <button class="buttonAb" th:if="${requests.size() > 0}" th:onclick="'openChatPopup(' + ${requests[0].id} + ')'" id="contactButton">
                KONTAKTIEREN
                <span id="notificationBadge" class="badge">1</span>
            </button>
        </div>
    </div>

    <!-- Modal for Chat -->
    <div id="chatPopup" class="chat-popup">
        <div class="chat-popup-content">
            <span class="close-button" onclick="closeChatPopup()">&times;</span>
            <div class="chat-container" id="chatContainer">
                <!-- Chat messages will be displayed here -->
            </div>
            <form id="sendClientMessage">
                <input type="text" id="clientText" name="text" placeholder="Type your message..." required>
                <button type="submit">Send</button>
                <input type="hidden" id="sender" name="sender" th:value="${#httpServletRequest.remoteUser}" />
                <input type="hidden" id="receiver" name="receiver"/>
            </form>
        </div>
    </div>
</body>
</html>
